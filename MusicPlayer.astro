---
import 'aplayer-ts/src/css/base.css';
import { resolveSong, type MusicPlayerProps } from "./resolver";

interface Props extends MusicPlayerProps {}

const playerClass = `aplayer-${Astro.props.netease}`;
const { name, artist, url, pic } = await resolveSong(Astro.props);
---

{
  url === '' ? (
    <p>歌曲加载失败</p>
  ) : (
    <div class={playerClass} data-name={name} data-artist={artist} data-url={url} data-cover={pic}>
      音乐正在加载中 ...
    </div>
  )
}

<script define:vars={{playerClass}}>
import APlayer from 'aplayer-ts';

const ps = document.querySelectorAll(`.${playerClass}`);
for (const p of ps) {
  APlayer().init({
    container: p,
    audio: [
      {
        name: p.dataset.name,
        artist: p.dataset.artist,
        url: p.dataset.url,
        cover: p.dataset.cover,
        theme: '#ebd0c2',
      },
    ],
  });
}
</script>
